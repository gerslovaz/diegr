<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>diegr • diegr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="diegr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">diegr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/diegr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>diegr</h1>
            
      

      <div class="d-none name"><code>diegr.Rmd</code></div>
    </div>

    
    
<pre><code><span><span class="co">#&gt; Warning in rgl.init(initValue, onlyNULL): RGL: unable to open X11 display</span></span>
<span><span class="co">#&gt; Warning: 'rgl.init' failed, will use the null device.</span></span>
<span><span class="co">#&gt; See '?rgl.useNULL' for ways to avoid this warning.</span></span></code></pre>
<p>The package <code>diegr</code> displays high-density
electroencephalography (HD-EEG) data in different ways using interactive
elements or animations for a comprehensive overview of data.</p>
<div class="section level3">
<h3 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"diegr"</span><span class="op">)</span> </span>
<span><span class="co"># or for development version:</span></span>
<span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"gerslovaz/diegr"</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>The package contains built-in datasets. Due to the nature of the
experiment and the size of the data, this is only a small section which
serves as a demonstration of the implemented functions and it is not
possible to reconstruct the real signal of a specific sensor or subject
from it. Details of the experiment from which the original data comes
can be found in Madetko-Alster and col., 2025.</p>
<div class="section level4">
<h4 id="epochdata">epochdata<a class="anchor" aria-label="anchor" href="#epochdata"></a>
</h4>
<p>The brain signal originally measured by 256-channel HydroCel Geodesic
Sensor Net with sampling frequency 250 Hz. Example dataset contains
amplitude values from 204 selected channels at 50 time points (stimulus
at time point 10) for 2 representative subjects (one healthy control,
one patient). Out of 50 epochs per subject, 14 (or 15, respectively)
were selected.</p>
<p>The data is organized into a data frame with the following
columns:</p>
<ul>
<li>
<code>time</code>: Number of time point. Number 10 indicates the
time of stimulus (0 ms), the interval between two time points
corresponds to 4 ms (sampling frequency 250 Hz).</li>
<li>
<code>signal</code>: HD-EEG signal amplitude (in microvolts).</li>
<li>
<code>epoch</code>: Epoch number (there are 14 epochs for subject
one, 15 epochs for subject two).</li>
<li>
<code>sensor</code>: Sensor label (labeling corresponds to the
Geodesic Sensor Net Technical Manual, 2024).</li>
<li>
<code>subject</code>: Subject ID (1 - representative healthy control
subject, 2 - representative patient subject).</li>
</ul>
</div>
<div class="section level4">
<h4 id="hcgsn256">HCGSN256<a class="anchor" aria-label="anchor" href="#hcgsn256"></a>
</h4>
<p>The Cartesian coordinates of HD-EEG sensor positions in 3D space on
the scalp surface and their projection into 2D space according to
256-channel HydroCel Geodesic Sensor Net average template montage.</p>
<p>The data is organized into a list with the following elements:</p>
<ul>
<li>
<code>D2</code>: A tibble with coordinates and labels of sensors in
2D.</li>
<li>
<code>D3</code>: A tibble with coordinates and labels of sensors in
3D.</li>
<li>
<code>ROI</code>:A vector with the region of interest (ROI)
assignment for each sensor (“central”, “frontal”, “occipital”,
“parietal” or “temporal” according to the brain regions and “face” for
the face area). Sensors are labeled according to Geodesic Sensor Net
Technical Manual, 2024.</li>
</ul>
<p>Axis orientation (3D): - x: left (-) to right (+); - y: posterior (-)
to anterior (+); - z: inferior (-) to superior (+).</p>
</div>
<div class="section level4">
<h4 id="rtdata">rtdata<a class="anchor" aria-label="anchor" href="#rtdata"></a>
</h4>
<p>The response time values in individual experiment epochs for 2
representative subjects (one from patient, one from healthy control
group). The epochs and subjects correspond to the sample dataset
<code>epochdata</code>.</p>
<p>The data is organized into a data frame with the following
columns:</p>
<ul>
<li>
<code>subject</code>: Subject ID (1 - representative healthy control
subject, 2 - representative patient subject).</li>
<li>
<code>epoch</code>: Epoch number (there are 14 epochs for subject
one, 15 epochs for subject two).</li>
<li>
<code>RT</code>: Response time in ms.</li>
</ul>
</div>
</div>
<div class="section level3">
<h3 id="tools-useful-in-preprocessing">Tools useful in preprocessing<a class="anchor" aria-label="anchor" href="#tools-useful-in-preprocessing"></a>
</h3>
<p>The package assumes that the input data have already been
preprocessed (artifact removal, independent component analysis - ICA,
segmentation, …), but may still contain outliers that should be excluded
for specific statistical analyses.</p>
<p>The useful tool in outliers detection is interactive plot with
boxplots of amplitudes (<code><a href="../reference/boxplot_epoch.html">boxplot_epoch()</a></code>) or response times
(<code><a href="../reference/boxplot_rt.html">boxplot_rt()</a></code>) in individual epochs. The
<code>plotly</code> output makes it easy to determine the epoch number
from which outliers come and additionally allows editing of the output
image layout.</p>
<p>There is also an interactive graph of amplitudes in individual epochs
with (or without) the average plotted
(<code><a href="../reference/interactive_waveforms.html">interactive_waveforms()</a></code>). This function can also be used
to compare signals across different experimental levels (e.g., sensor,
subject, group, or condition) as specified by the <code>level</code>
argument.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The function for interactive boxplot of signal assumes </span></span>
<span><span class="co"># pre-filtered data input</span></span>
<span><span class="co"># example: subject 1 and channel E34 in time points from 10 to 20</span></span>
<span><span class="va">subdata</span> <span class="op">&lt;-</span> <span class="va">epochdata</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/pick_data.html">pick_data</a></span><span class="op">(</span>subject_rg <span class="op">=</span> <span class="fl">1</span>, sensor_rg <span class="op">=</span> <span class="st">"E34"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/boxplot_epoch.html">boxplot_epoch</a></span><span class="op">(</span><span class="va">subdata</span>, amplitude <span class="op">=</span> <span class="st">"signal"</span>, time_lim <span class="op">=</span> <span class="fl">10</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># customizing the output title and axis labels using |&gt; operator</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/boxplot_epoch.html">boxplot_epoch</a></span><span class="op">(</span><span class="va">subdata</span>, amplitude <span class="op">=</span> <span class="st">"signal"</span>, time_lim <span class="op">=</span> <span class="fl">10</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span><span class="va">p1</span> <span class="op">|&gt;</span> <span class="fu">plotly</span><span class="fu">::</span><span class="fu">layout</span><span class="op">(</span>xaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">""</span><span class="op">)</span>,</span>
<span>                     yaxis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Amplitude"</span><span class="op">)</span>,</span>
<span>                     title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>text <span class="op">=</span> <span class="st">"Outlier detection for subject 1 and channel E34"</span>,</span>
<span>                                  font <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">11</span>, color <span class="op">=</span> <span class="st">"darkblue"</span><span class="op">)</span><span class="op">)</span></span>
<span>                     <span class="op">)</span></span>
<span><span class="co"># note: the output is not plotted to reduce the vignette file size</span></span></code></pre></div>
<p>Outlier epochs can be easily detected using the hover text in the
<code>plotly</code> output. In the case above, the outlier is epoch
14.</p>
<p>The results can be supported computationally by the
<code><a href="../reference/outliers_epoch.html">outliers_epoch()</a></code> function, which allows the evaluation of
outliers using one of three criteria (interquartile range - IQR,
percentile approach or Hampel filter).<br>
The output of this function is a table containing epoch IDs and the
number of time points in which the epochs were evaluated as outliers
(according to chosen criteria) for unique combinations of input
variables (e.g. group, subject, sensor).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Example: outlier detection for both subjects and channel E34 using IQR method</span></span>
<span><span class="co"># The column in which we are looking for outliers is specified by the `amplitude` argument</span></span>
<span><span class="va">epochdata</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/pick_data.html">pick_data</a></span><span class="op">(</span>sensor_rg <span class="op">=</span> <span class="st">"E34"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span><span class="fu"><a href="../reference/outliers_epoch.html">outliers_epoch</a></span><span class="op">(</span>amplitude <span class="op">=</span> <span class="st">"signal"</span>, method <span class="op">=</span> <span class="st">"iqr"</span><span class="op">)</span></span></code></pre></div>
<p>The results correspond with findings from
<code><a href="../reference/boxplot_epoch.html">boxplot_epoch()</a></code> - for subject 1, epoch 14 was evaluated as
an outlier in all 50 time points.</p>
<p>Analogously to function <code><a href="../reference/boxplot_epoch.html">boxplot_epoch()</a></code>, function
<code><a href="../reference/boxplot_subject.html">boxplot_subject()</a></code> works to identify outliers at the subject
level.</p>
</div>
<div class="section level3">
<h3 id="preparing-signal-for-visualisation">Preparing signal for visualisation<a class="anchor" aria-label="anchor" href="#preparing-signal-for-visualisation"></a>
</h3>
<p>The main focus of the package is interactive visualization and
animation of the HD-EEG data. This often requires first baseline
correcting the data or averaging the signal across epochs, sensors/time
points, or subjects.</p>
<p>The baseline correction of the amplitude is enabled through the
function <code><a href="../reference/baseline_correction.html">baseline_correction()</a></code>. In the first release of the
package, only most commonly used absolute correction
(<code>type = "absolute"</code>), which subtracts mean over
<code>base_int</code>, is available.</p>
<p>The calculation of the average signal can be performed using the
function <code><a href="../reference/compute_mean.html">compute_mean()</a></code>, which computes pointwise
standard/weighted or jackknife (leave one out) mean of the signal at
different levels. In addition to the mean itself, the function also
calculates the boundaries of the point confidence interval
(<code>ci_low</code> and <code>ci_up</code> in the output). The argument
<code>domain</code> determines whether the average is calculated within
individual time points (for curves) - <code>domain = "time"</code> or
sensors (for topographic maps) - <code>domain = "space"</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># preparing data for later visualisation </span></span>
<span><span class="co"># filtering signal without outlier epochs 14 and 15</span></span>
<span><span class="co"># and computing epoch level jackknife average from baseline corrected data</span></span>
<span><span class="co"># Note: data filtering is possible both using the pick_data() function or dplyr commands</span></span>
<span><span class="va">edata</span> <span class="op">&lt;-</span> <span class="va">epochdata</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/pick_data.html">pick_data</a></span><span class="op">(</span>subject_rg <span class="op">=</span> <span class="fl">2</span>, epoch_rg <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/baseline_correction.html">baseline_correction</a></span><span class="op">(</span>baseline_range <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">s1</span> <span class="op">&lt;-</span> <span class="va">edata</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time</span> <span class="op">==</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/compute_mean.html">compute_mean</a></span><span class="op">(</span>amplitude <span class="op">=</span> <span class="st">"signal_base"</span>, level <span class="op">=</span> <span class="st">"epoch"</span>,</span>
<span>               domain <span class="op">=</span> <span class="st">"space"</span>, type <span class="op">=</span> <span class="st">"jack"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="temporal-domain-visualization">Temporal domain visualization<a class="anchor" aria-label="anchor" href="#temporal-domain-visualization"></a>
</h3>
<p>The <code><a href="../reference/interactive_waveforms.html">interactive_waveforms()</a></code> and
<code><a href="../reference/plot_time_mean.html">plot_time_mean()</a></code> can be used to display the time course of
the signal. While function <code><a href="../reference/interactive_waveforms.html">interactive_waveforms()</a></code>
interactively displays individual waveforms at different levels via
<code>plotly</code>, function <code><a href="../reference/plot_time_mean.html">plot_time_mean()</a></code> is adapted
directly to display the average signal including the pointwise
confidence interval as a <code>ggplot</code> object.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># computing jackknife average from channel E65 </span></span>
<span><span class="va">s2</span> <span class="op">&lt;-</span> <span class="va">edata</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/pick_data.html">pick_data</a></span><span class="op">(</span>sensor_rg <span class="op">=</span> <span class="st">"E65"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/compute_mean.html">compute_mean</a></span><span class="op">(</span>amplitude <span class="op">=</span> <span class="st">"signal_base"</span>, level <span class="op">=</span> <span class="st">"epoch"</span>,</span>
<span>               domain <span class="op">=</span> <span class="st">"time"</span>, type <span class="op">=</span> <span class="st">"jack"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plotting the average, the zero time point (stimulus) is set to 10</span></span>
<span><span class="fu"><a href="../reference/plot_time_mean.html">plot_time_mean</a></span><span class="op">(</span><span class="va">s2</span>, t0 <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="diegr_files/figure-html/unnamed-chunk-6-1.png" class="r-plt" alt="An average amplitude time-series plot showing the brain's electrical activity (in microvolts) over time (in milliseconds), time-locked to a stimulus event at 0 ms. The red line represents the average amplitude, and the shaded red area represents the confidence interval." width="700"></p>
</div>
<div class="section level3">
<h3 id="spatial-visualization">Spatial visualization<a class="anchor" aria-label="anchor" href="#spatial-visualization"></a>
</h3>
<div class="section level4">
<h4 id="mesh-generation">Mesh Generation<a class="anchor" aria-label="anchor" href="#mesh-generation"></a>
</h4>
<p>The original electrode grid is too coarse for graphical rendering. To
achieve smoother and more visually appealing results in plots, it’s
necessary to generate a denser mesh of points. This refined mesh
provides better spatial resolution and enhances the quality of
visualizations. Creating a new mesh is available through
<code><a href="../reference/point_mesh.html">point_mesh()</a></code> function. This function computes the
coordinates of mesh in 2D and/or 3D and enables to control a density
(argument <code>n</code>) or the shape (argument <code>type</code>) of
the result mesh.<br>
The default setting creates a polygonal mesh with starting number 10000
points and computes the coordinates in both dimensions, which are
available in <code>$D2</code> and <code>$D3</code> parts of a result
list (class <code>"mesh"</code>).</p>
<p>For simple created mesh plotting use the function
<code><a href="../reference/plot_point_mesh.html">plot_point_mesh()</a></code>, which results in two dimensional
<code>ggplot</code> of point mesh or three dimensional <code>rgl</code>
plot depending on the input dimension.</p>
<p>Notes:</p>
<ul>
<li>Creating and plotting a mesh for subset from the whole template
montage is available through <code>sensor_select</code> parameter. For
consistency between created mesh and its plot use the same vector of
sensor labels in both functions.</li>
<li>The input of <code><a href="../reference/plot_point_mesh.html">plot_point_mesh()</a></code> must be only the
relevant part with coordinates - <code>$D2</code> for two dimensional
and <code>$D3</code> for three dimensional plot.</li>
<li>If the number of mesh points is large, they are no longer visible in
the plot and the mesh looks like a solid surface (as can be seen below
in first plot).</li>
<li>Depending on the hardware used, the computational cost of default
<code>n = 10000</code> can be high. In this case we recommend to reduce
<code>n</code> and to reuse a precomputed mesh across plots for
speed.</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># creating a mesh with default settings</span></span>
<span><span class="va">sensors204</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">epochdata</span><span class="op">$</span><span class="va">sensor</span><span class="op">)</span></span>
<span><span class="va">M1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/point_mesh.html">point_mesh</a></span><span class="op">(</span>template <span class="op">=</span> <span class="st">"HCGSN256"</span>, sensor_select <span class="op">=</span> <span class="va">sensors204</span><span class="op">)</span></span>
<span><span class="co"># plot output in 2D</span></span>
<span><span class="fu"><a href="../reference/plot_point_mesh.html">plot_point_mesh</a></span><span class="op">(</span><span class="va">M1</span><span class="op">$</span><span class="va">D2</span>, sensor_select <span class="op">=</span> <span class="va">sensors204</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># creating a circular mesh, only 2D coordinates</span></span>
<span><span class="va">M2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/point_mesh.html">point_mesh</a></span><span class="op">(</span>dimension <span class="op">=</span> <span class="fl">2</span>, n <span class="op">=</span> <span class="fl">3000</span>, template <span class="op">=</span> <span class="st">"HCGSN256"</span>,</span>
<span>                 sensor_select <span class="op">=</span> <span class="va">sensors204</span>, type <span class="op">=</span> <span class="st">"circle"</span><span class="op">)</span></span>
<span><span class="co"># plotting a mesh - function allows different options of the result plot</span></span>
<span><span class="fu"><a href="../reference/plot_point_mesh.html">plot_point_mesh</a></span><span class="op">(</span><span class="va">M2</span><span class="op">$</span><span class="va">D2</span>, sensor_select <span class="op">=</span> <span class="va">sensors204</span>, col_sensors <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>                label_sensors <span class="op">=</span> <span class="cn">TRUE</span>, cex <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="diegr_files/figure-html/unnamed-chunk-7-1.png" class="r-plt" alt="A schematic representations of an HD-EEG sensor net, showing the arrangement of 204 labeled channels distributed across the entire scalp area together with denser point mesh created for interpolation." width="700"><img src="diegr_files/figure-html/unnamed-chunk-7-2.png" class="r-plt" alt="A schematic representations of an HD-EEG sensor net, showing the arrangement of 204 labeled channels distributed across the entire scalp area together with denser point mesh created for interpolation." width="700"></p>
<p><code>diegr</code>’s plotting functions also allow users to input the
custom mesh created in other way, it is only necessary to maintain the
structure following a <code>"mesh"</code> object.<br>
If the <code>mesh</code> input is not specified, the graphic functions
automatically use the mesh created by <code><a href="../reference/point_mesh.html">point_mesh()</a></code> with
default settings.</p>
</div>
<div class="section level4">
<h4 id="topographical-maps-in-2d-projection">Topographical maps in 2D projection<a class="anchor" aria-label="anchor" href="#topographical-maps-in-2d-projection"></a>
</h4>
<p>The <code><a href="../reference/topo_plot.html">topo_plot()</a></code> function is used to plot a topographic
map of the brain signal, the amplitude values are colored by default
using a topographic colour scale. An alternative to this function
adapted directly to plot the mean along with the confidence interval
bounds is <code><a href="../reference/plot_topo_mean.html">plot_topo_mean()</a></code>. In the default topographic
colour scale, amplitude = 0 is mapped to the blue–green boundary;
positive values trend towards yellow/red, negative towards dark blue.
The <code>coulour_scale()</code> function also offers the
<code>"redblue"</code> palette, with negative values corresponding to
shades of blue and positive values corresponding to shades of red.
Additionally, the users can choose their own palettes using
<code>col_scale</code> argument.</p>
<p>Both <code>topo_</code> functions allow setting some optionally
arguments for editing the output appearance (with or without contours,
sensor names, etc.) and return <code>ggplot</code> object for further
customization.</p>
<p>Notes:</p>
<ul>
<li><p>The input values of amplitude (or also CI bounds in the case of
the <code><a href="../reference/plot_topo_mean.html">plot_topo_mean()</a></code> function) outside the chosen
<code>col_range</code> will cause “holes” in the resulting
plot.</p></li>
<li><p>To compare results for different subjects or conditions, setting
the same values of <code>col_range</code> and <code>col_scale</code>
arguments in all cases is necessary.</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot average topographic map of baseline corrected signal for subject 1 </span></span>
<span><span class="co"># from the time point 10 (the time of the stimulus)</span></span>
<span><span class="co"># the outlier epoch 14 is extracted before computing average</span></span>
<span></span>
<span><span class="co"># preparing data</span></span>
<span><span class="va">data_base</span> <span class="op">&lt;-</span> <span class="va">epochdata</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/pick_data.html">pick_data</a></span><span class="op">(</span>subject_rg <span class="op">=</span> <span class="fl">1</span>, time_rg <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/baseline_correction.html">baseline_correction</a></span><span class="op">(</span>baseline_range <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_mean</span> <span class="op">&lt;-</span> <span class="va">data_base</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/pick_data.html">pick_data</a></span><span class="op">(</span>epoch_rg <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">13</span>, time_rg <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/compute_mean.html">compute_mean</a></span><span class="op">(</span>amplitude <span class="op">=</span> <span class="st">"signal_base"</span>, type <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>               domain <span class="op">=</span> <span class="st">"space"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plotting the base topographic polygon map with contours and legend</span></span>
<span><span class="co"># interval (-30,15) is selected in consideration of the signal progress</span></span>
<span><span class="fu"><a href="../reference/topo_plot.html">topo_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_mean</span>, amplitude <span class="op">=</span> <span class="st">"average"</span>, </span>
<span>          col_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>, <span class="fl">15</span><span class="op">)</span>, contour <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plotting the same map without contours and legend </span></span>
<span><span class="co"># but with sensor labels and adding the title</span></span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/topo_plot.html">topo_plot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_mean</span>, amplitude <span class="op">=</span> <span class="st">"average"</span>,</span>
<span>                col_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>, <span class="fl">15</span><span class="op">)</span>,</span>
<span>                label_sensors <span class="op">=</span> <span class="cn">TRUE</span>, show_legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">g1</span> <span class="op">+</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Subject 1, time of the stimulus"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plotting the average together with CI bounds using plot_topo_mean</span></span>
<span><span class="fu"><a href="../reference/plot_topo_mean.html">plot_topo_mean</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_mean</span>, template <span class="op">=</span> <span class="st">"HCGSN256"</span>, col_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="diegr_files/figure-html/unnamed-chunk-8-1.png" class="r-plt" alt="Fig 1: A top-down topographic map of a high-density EEG amplitude in topographic colour scale with contours and black points on sensor locations. The amplitude legend is on the left side of the scalp projection. Fig 2: The same plot without contours and legend, but with sensor labels as text displayed together with black point on sensor positions. Fig 3: A ggplot divided into three panels with topographic maps of average signal (middle) and its lower (left) and upper (right) confidence interval bounds. The colour legend position is bottom of the facets." width="700"><img src="diegr_files/figure-html/unnamed-chunk-8-2.png" class="r-plt" alt="Fig 1: A top-down topographic map of a high-density EEG amplitude in topographic colour scale with contours and black points on sensor locations. The amplitude legend is on the left side of the scalp projection. Fig 2: The same plot without contours and legend, but with sensor labels as text displayed together with black point on sensor positions. Fig 3: A ggplot divided into three panels with topographic maps of average signal (middle) and its lower (left) and upper (right) confidence interval bounds. The colour legend position is bottom of the facets." width="700"><img src="diegr_files/figure-html/unnamed-chunk-8-3.png" class="r-plt" alt="Fig 1: A top-down topographic map of a high-density EEG amplitude in topographic colour scale with contours and black points on sensor locations. The amplitude legend is on the left side of the scalp projection. Fig 2: The same plot without contours and legend, but with sensor labels as text displayed together with black point on sensor positions. Fig 3: A ggplot divided into three panels with topographic maps of average signal (middle) and its lower (left) and upper (right) confidence interval bounds. The colour legend position is bottom of the facets." width="700"></p>
</div>
<div class="section level4">
<h4 id="topographical-maps-on-the-scalp">Topographical maps on the scalp<a class="anchor" aria-label="anchor" href="#topographical-maps-on-the-scalp"></a>
</h4>
<p>The <code><a href="../reference/scalp_plot.html">scalp_plot()</a></code> function is created for plotting a
scalp polygon map of the EEG signal amplitude using by default the same
topographic colour scale as in <code><a href="../reference/topo_plot.html">topo_plot()</a></code>). The result
plot is rendered using <code><a href="https://dmurdoch.github.io/rgl/dev/reference/mesh3d.html" class="external-link">rgl::shape3d</a></code> function and the signal
interpolation between sensor locations is based on thin-plate spline
interpolation model.<br>
Correct mesh triangulation is required for appropriate colour rendering.
This triangulation is constructed by <code><a href="../reference/make_triangulation.html">make_triangulation()</a></code>,
which creates a Delaunay type-I triangulation (Lai &amp; Schumaker,
2007) with consistently oriented edges (Schneider &amp; Eberly,
2003).</p>
<p>Note: - The input values of amplitude outside the chosen
<code>col_range</code> will cause “holes” in the resulting plot. - To
obtain comparable results between different subjects or conditions,
setting the same values of <code>col_range</code> and
<code>col_scale</code> arguments in all cases is necessary.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plotting the scalp polygon map of previously prepared signal s1</span></span>
<span><span class="co">#open3d()</span></span>
<span><span class="fu"><a href="../reference/scalp_plot.html">scalp_plot</a></span><span class="op">(</span><span class="va">s1</span>, amplitude <span class="op">=</span> <span class="st">"average"</span>, col_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note: the output is not plotted to reduce the vignette file size</span></span></code></pre></div>
<p>The <code>rgl</code> output enables to zoom and rotate the image with
default view of the back of the head.</p>
</div>
</div>
<div class="section level3">
<h3 id="animations">Animations<a class="anchor" aria-label="anchor" href="#animations"></a>
</h3>
<p>The package includes the <code><a href="../reference/animate_topo.html">animate_topo()</a></code> and
<code><a href="../reference/animate_topo_mean.html">animate_topo_mean()</a></code> function for 2D topographic animation
in time and <code><a href="../reference/animate_scalp.html">animate_scalp()</a></code> function for 3D scalp animation
in time. Both of these functions allow to export the output, a gif
animation using <code>gifski</code> package for 2D case and a .mp4 video
format using <code>av</code> package for 3D case. The topographic map
animation uses <code>gganimate</code> and and accepts additional
parameters passed to <code><a href="https://gganimate.com/reference/animate.html" class="external-link">gganimate::animate()</a></code> via
<code>...</code>. The most of input parameters of
<code><a href="../reference/animate_topo.html">animate_topo()</a></code> are the same as in <code><a href="../reference/topo_plot.html">topo_plot()</a></code>
function, parameters related to animation properties and export are
added and also the <code>t_lim</code> parameter for setting the length
of the timeline displayed below the animation. The
<code><a href="../reference/animate_topo_mean.html">animate_topo_mean()</a></code> function is customized for topographic
maps of average signal together with pointwise confidence interval
bounds displayed as topographic maps on the sides of the average map.
Usage is almost identical to the <code><a href="../reference/animate_topo.html">animate_topo()</a></code> function,
only input data must contain columns <code>average</code>,
<code>ci_up</code> and <code>ci_low</code> (like the output from the
<code>compute_mean</code> function). Example: The animation of time
course of the EEG signal for subject 1 and epoch 5 (from
<code>epochdata</code>) between time points 10 and 20 with the whole
range of time 0:50 is created as follows (the output is not rendered to
reduce the vignette file size):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># filtering the example data </span></span>
<span><span class="va">s1e05</span> <span class="op">&lt;-</span> <span class="va">epochdata</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="../reference/pick_data.html">pick_data</a></span><span class="op">(</span>subject_rg <span class="op">=</span> <span class="fl">1</span>, epoch_rg <span class="op">=</span> <span class="fl">5</span>, time_rg <span class="op">=</span> <span class="fl">10</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot animation with setting the range of time and t0 = 10 indicating the time of the stimulus:</span></span>
<span><span class="fu"><a href="../reference/animate_topo.html">animate_topo</a></span><span class="op">(</span><span class="va">s1e05</span>, amplitude <span class="op">=</span> <span class="st">"signal"</span>, t_lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">50</span><span class="op">)</span>, t0 <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Export the gif animation - this code will create the animation inside your working directory.</span></span>
<span><span class="co"># If you want to export it elsewhere, set the whole path in output_path parameter.</span></span>
<span><span class="fu"><a href="../reference/animate_topo.html">animate_topo</a></span><span class="op">(</span><span class="va">s1e05</span>, amplitude <span class="op">=</span> <span class="st">"signal"</span>, t_lim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">50</span><span class="op">)</span>,</span>
<span>             t0 <span class="op">=</span> <span class="fl">10</span>, output_path <span class="op">=</span> <span class="st">"example_animation.gif"</span><span class="op">)</span></span></code></pre></div>
<p>The scalp animation enables to export a video in <code>.mp4</code>
format using the <code>av</code> package or save a sequence of frames
into chosen directory setting the <code>frames_dir</code> parameter. The
animation speed can be controlled by the <code>sec</code> parameter in
the viewer or by the <code>framerate</code> parameter for the exported
video. The video resolution quality can be affected using
<code>par3d</code> function, for example
<code>rgl::par3d(windowRect = c(100, 100, 800, 800))</code>. Example of
scalp animation with the same data as above (the output is not rendered
to reduce the vignette file size):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot animation with default mesh and triangulation:</span></span>
<span><span class="fu"><a href="../reference/animate_scalp.html">animate_scalp</a></span><span class="op">(</span><span class="va">s1e05</span>, amplitude <span class="op">=</span> <span class="st">"signal"</span><span class="op">)</span></span>
<span><span class="co"># export the video - the .mp4 extension is required for correct functioning</span></span>
<span><span class="fu">rgl</span><span class="fu">::</span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/par3d.html" class="external-link">par3d</a></span><span class="op">(</span>windowRect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">800</span>, <span class="fl">800</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/animate_scalp.html">animate_scalp</a></span><span class="op">(</span><span class="va">s1e05</span>, amplitude <span class="op">=</span> <span class="st">"signal"</span>, </span>
<span>              frames_dir <span class="op">=</span> <span class="st">"your_frames_dir_path"</span>, </span>
<span>              output_path <span class="op">=</span> <span class="st">"your_created_video_path.mp4"</span><span class="op">)</span></span></code></pre></div>
<p>If you are interested in animation of rotating scalp visualization in
fixed time point, you can easily achieve this by using the combination
of <code><a href="https://dmurdoch.github.io/rgl/dev/reference/play3d.html" class="external-link">rgl::play3d</a></code> and <code><a href="https://dmurdoch.github.io/rgl/dev/reference/spin3d.html" class="external-link">rgl::spin3d</a></code> functions
according to the following code.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#open3d()</span></span>
<span><span class="fu"><a href="../reference/scalp_plot.html">scalp_plot</a></span><span class="op">(</span><span class="va">s1</span>, amplitude <span class="op">=</span> <span class="st">"average"</span>, col_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">30</span>,<span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">rgl</span><span class="fu">::</span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/play3d.html" class="external-link">play3d</a></span><span class="op">(</span><span class="fu">rgl</span><span class="fu">::</span><span class="fu"><a href="https://dmurdoch.github.io/rgl/dev/reference/spin3d.html" class="external-link">spin3d</a></span><span class="op">(</span>axis <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, rpm <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, duration <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note: the output is not plotted to reduce the vignette file size</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-by-step-example-comparing-topographic-maps-of-two-subjects">Step-by-step example: Comparing Topographic Maps of Two
Subjects<a class="anchor" aria-label="anchor" href="#step-by-step-example-comparing-topographic-maps-of-two-subjects"></a>
</h3>
<p>In this section we present a sample code for analyzing topographic
maps across subjects:</p>
<ol style="list-style-type: decimal">
<li>Outliers detection</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using IQR method for selected sensor from central region </span></span>
<span><span class="va">dataE59</span> <span class="op">&lt;-</span> <span class="va">epochdata</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/pick_data.html">pick_data</a></span><span class="op">(</span>sensor_rg <span class="op">=</span> <span class="st">"E59"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/outliers_epoch.html">outliers_epoch</a></span><span class="op">(</span><span class="va">dataE59</span>, method <span class="op">=</span> <span class="st">"iqr"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># verify results by visual inspection (for each subject separately)</span></span>
<span><span class="va">dataE59</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/interactive_waveforms.html">interactive_waveforms</a></span><span class="op">(</span>amplitude <span class="op">=</span> <span class="st">"signal"</span>, level <span class="op">=</span> <span class="st">"epoch"</span>,</span>
<span>                        t0 <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">dataE59</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/interactive_waveforms.html">interactive_waveforms</a></span><span class="op">(</span>amplitude <span class="op">=</span> <span class="st">"signal"</span>, level <span class="op">=</span> <span class="st">"epoch"</span>,</span>
<span>                        t0 <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>Subject 1: epoch 14 is an obvious outlier. Subject 2: epoch 15 is an
obvious outlier, epoch 14 was denoted as outlier for 37 time points - we
exclude both of them from further analysis.</p>
<ol start="2" style="list-style-type: decimal">
<li>Baseline correction</li>
</ol>
<p>We exclude outlier epochs before baseline correction, otherwise they
would affect the baseline average computing.</p>
<p>Note: If there are multiple subjects (or other variables) in the
input data, the <code><a href="../reference/baseline_correction.html">baseline_correction()</a></code> add them into
grouping structure, so the baseline calculation is provided separately
for unique combinations of these variables. This procedure allows to
compute baseline correction for both subjects in one step.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subjects_base</span> <span class="op">&lt;-</span> <span class="va">epochdata</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/pick_data.html">pick_data</a></span><span class="op">(</span>epoch_rg <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/baseline_correction.html">baseline_correction</a></span><span class="op">(</span>baseline_range <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Average computing</li>
</ol>
<p>We compute average topographic map in time point 35 (100 ms after
stimulus) for both subjects. We use standard (un-weighted) pointwise
average with bootstrap confidence intervals.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">subjects_mean</span> <span class="op">&lt;-</span> <span class="va">subjects_base</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time</span> <span class="op">==</span> <span class="fl">35</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/compute_mean.html">compute_mean</a></span><span class="op">(</span>amplitude <span class="op">=</span> <span class="st">"signal_base"</span>, domain <span class="op">=</span> <span class="st">"space"</span>,</span>
<span>               level <span class="op">=</span> <span class="st">"epoch"</span>, R <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Average plotting</li>
</ol>
<p>To maintain consistency between both subjects, we first construct a
mesh and set colour range that we will use in both figures:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># prepare a mesh for plotting</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/point_mesh.html">point_mesh</a></span><span class="op">(</span>dimension <span class="op">=</span> <span class="fl">2</span>, n <span class="op">=</span> <span class="fl">4000</span>, template <span class="op">=</span> <span class="st">"HCGSN256"</span>,</span>
<span>                sensor_select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">subjects_mean</span><span class="op">$</span><span class="va">sensor</span><span class="op">)</span>,</span>
<span>                type <span class="op">=</span> <span class="st">"polygon"</span><span class="op">)</span></span>
<span><span class="co"># compute consistent col_range across subjects</span></span>
<span><span class="co"># a) find the range of average amplitude</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">subjects_mean</span><span class="op">$</span><span class="va">average</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] -15.634288   8.609518</span></span>
<span><span class="co"># -15.634288   8.609518</span></span>
<span><span class="co"># b) make the range symmetric</span></span>
<span><span class="va">cr_subjects</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">16</span>,<span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<p>For plotting, we will use the <code><a href="../reference/plot_topo_mean.html">plot_topo_mean()</a></code> function,
which is directly adapted for rendering topographic map of the average
EEG amplitude together with its lower and upper confidence interval (CI)
bounds.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot the average topographic maps with the same color range for both subjects</span></span>
<span><span class="va">subjects_mean</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_topo_mean.html">plot_topo_mean</a></span><span class="op">(</span>mesh <span class="op">=</span> <span class="va">M</span>, template <span class="op">=</span> <span class="st">"HCGSN256"</span>,</span>
<span>                 col_range <span class="op">=</span> <span class="va">cr_subjects</span>, contour <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">subjects_mean</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">subject</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/plot_topo_mean.html">plot_topo_mean</a></span><span class="op">(</span>mesh <span class="op">=</span> <span class="va">M</span>, template <span class="op">=</span> <span class="st">"HCGSN256"</span>,</span>
<span>                 col_range <span class="op">=</span> <span class="va">cr_subjects</span>, contour <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># note: the output is not plotted to reduce the vignette file size</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Average difference plot</li>
</ol>
<p>To display difference in the average of both subjects considered in
the example, we can also use the red-blue colour palette inside the
<code><a href="../reference/topo_plot.html">topo_plot()</a></code> function.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute difference</span></span>
<span><span class="va">subjects_diff</span> <span class="op">&lt;-</span> <span class="va">subjects_mean</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">sensor</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span></span>
<span>    diff <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">average</span><span class="op">[</span><span class="va">.data</span><span class="op">$</span><span class="va">subject</span> <span class="op">==</span> <span class="st">"1"</span><span class="op">]</span> <span class="op">-</span> <span class="va">.data</span><span class="op">$</span><span class="va">average</span><span class="op">[</span><span class="va">.data</span><span class="op">$</span><span class="va">subject</span> <span class="op">==</span> <span class="st">"2"</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># create colour scale</span></span>
<span><span class="va">CS1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_scale.html">create_scale</a></span><span class="op">(</span>col_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">subjects_diff</span><span class="op">$</span><span class="va">diff</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"redblue"</span><span class="op">)</span></span>
<span><span class="co"># display the plot: positive difference values (i.e., average for subject 1 higher than for subject 2)</span></span>
<span><span class="co"># are displayed in shades of red, negative values in shades of blue</span></span>
<span><span class="fu"><a href="../reference/topo_plot.html">topo_plot</a></span><span class="op">(</span><span class="va">subjects_diff</span>, amplitude <span class="op">=</span> <span class="st">"diff"</span>, mesh <span class="op">=</span> <span class="va">M</span>,</span>
<span>          template <span class="op">=</span> <span class="st">"HCGSN256"</span>, col_scale <span class="op">=</span> <span class="va">CS1</span><span class="op">)</span></span></code></pre></div>
<p><img src="diegr_files/figure-html/unnamed-chunk-18-1.png" class="r-plt" alt="A top-down topographic map of a high-density EEG amplitude difference of two subjects in red-blue colour scale with contours and black points on sensor locations. The amplitude legend is on the left side of the scalp projection." width="700"></p>
<div class="section level4">
<h4 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h4>
<p>Lai M-J, Schumaker LL. <em>Spline functions on triangulations.</em>
Cambridge University Press; 2007.</p>
<p>Schneider PJ, Eberly DH. <em>Geometric Tools for Computer
Graphics.</em> The Morgan Kaufmann Series in Computer Graphics. San
Francisco: Morgan Kaufmann, 2003.</p>
<p>Madetko-Alster N., Alster P., Lamoš M., Šmahovská L., Boušek T.,
Rektor I. and Bočková M. The role of the somatosensory cortex in
self-paced movement impairment in Parkinson’s disease. <em>Clinical
Neurophysiology.</em> 2025, vol. 171, 11-17. <a href="https://doi.org/10.1016/j.clinph.2025.01.001" class="external-link uri">https://doi.org/10.1016/j.clinph.2025.01.001</a></p>
<p>Wickham H, Bryan J. <em>R Packages (2e).</em> O’Reilly Media;
2023.</p>
<p>Wickham H. <em>ggplot2: Elegant Graphics for Data Analysis.</em>
Springer; 2016.</p>
<p>Electrical Geodesics, Inc.: <em>Geodesic Sensor Net Technical
Manual</em>. 2024. <a href="https://www.egi.com/knowledge-center" class="external-link uri">https://www.egi.com/knowledge-center</a></p>
</div>
<div class="section level4">
<h4 id="reproducibility-system-requirements">Reproducibility &amp; System Requirements<a class="anchor" aria-label="anchor" href="#reproducibility-system-requirements"></a>
</h4>
<blockquote>
<p><strong>This document was compiled on 2026-01-26 using R version
4.5.2 and the following package versions:</strong></p>
<ul>
<li>
<p><strong>Primary Packages:</strong></p>
<ul>
<li>
<code>diegr</code> (version 0.2.0)</li>
<li>
<code>dplyr</code> (version 1.1.4)</li>
<li>
<code>rgl</code> (version 1.3.31)</li>
<li>
<code>plotly</code> (version 4.12.0)</li>
<li>
<code>gganimate</code> (version 1.0.11)</li>
<li>
<code>gifski</code> (version 1.32.0.2)</li>
<li>
<code>av</code> (version 0.9.6)</li>
</ul>
</li>
<li>
<p><strong>rgl on Headless Systems:</strong> The <code>rgl</code>
package requires specific setup for graphics on systems without a
display (headless servers, like those often used for package checks). If
you are reproducing this vignette on a headless system, ensure the
following command is run <strong>before</strong> loading
<code>rgl</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>rgl.useNULL <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Alternatively, set the environment variable RGL_USE_NULL="true"</span></span></code></pre></div>
</li>
<li><p><strong>Media Requirements:</strong> Interactive plots (from
<strong>plotly</strong>) and animations (from <strong>gganimate</strong>
and <strong>gifski</strong> / <strong>av</strong>) require the
respective R packages and, for local rendering or specific output
formats, may require external libraries or codecs. If media fails to
render, check the documentation for <code>plotly</code>,
<code>gganimate</code>, <code>gifski</code>, and <code>av</code>
regarding system dependencies for video/GIF encoding.</p></li>
</ul>
</blockquote>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zdeňka Geršlová.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
